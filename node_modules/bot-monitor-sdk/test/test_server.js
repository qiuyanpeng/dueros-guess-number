/**
 * Copyright (c) 2017 Baidu, Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


/**
 * @file server.js
 * @author liudesheng<liudesheng01@baidu.com>
 */

var http = require('http');
var util = require('util');

let Request  = require('../lib/Request');
let Response = require('../lib/Response');
let BotMonitor = require('../lib/BotMonitor');

let requestData = require('../data/intent_request_tax');
let responseData = require('../data/intent_response_tax');

http.createServer(function(req, res) {
    req.on('data', function(data) {
        console.log(data);
    });

    res.writeHead(200, {
        'Content-Type': 'text/plain;charset=utf-8','Access-Control-Allow-Origin':'*'
    });

    res.on('end', function() {
        var privatePemContent = '-----BEGIN RSA PRIVATE KEY-----\n' +
            'MIICXgIBAAKBgQC9IBXz2T6RkFuqfbRJLTLCE1Uw407lk41zHEiqgnEznht2DSTY\n' +
            'iW7GhvRlBS27fO+S5vQaiUwt4wEryMxEuUzJPhB9kyypr46AYYuY8XcWtutRLWs2\n' +
            '9zQ1sUvx4qiLqF1AWMVViQYrsLJXwBwqBz5N+p22q0wuH5rMizMm32Vf1QIDAQAB\n' +
            'AoGAN6HOk1JeM1dxf29GrxfajHg/YQgcVy/WNfwl6/I+9l4V2d337rJOoZtlHKov\n' +
            'T61qk53YRE4K2Jyj5YtFexm+2hooW690LDUdMzcRkYIsDKhyIw7iFa54B10JC6uM\n' +
            '6/ENkrj25fLu+HIF+6V0aTRqUsV0gqXIQQeNIK2Ym9x5vAECQQDhbccv0NzCTLHX\n' +
            'fcrbaWxlAfq496szGcONHB4PMX81Dy/EsgR07nYwT6vuaznBXyY25fGGfbSAi7yk\n' +
            'r4sTq0NVAkEA1sX1QVa0qVqpU61+yPxWhT0wula/rlsDMPTHJktCjQv9UPCea3w+\n' +
            'ABnTKP0048vibCnCTFBjyufAiIFpUdqqgQJBAN5J0dBktEskNXm4oQAaxLgVa5ZZ\n' +
            'IogRL7NFtp5kwHshrojWwW5Mdl7NMUy4jwsPOC+KLs/fxM28/RenwgxzJMECQQDQ\n' +
            'fbMsDoOqs3wU4yNk8LD8/v3CplvFYkyixbxeDEk6qxzp6euf5Cg76NX3wHYLfOz8\n' +
            'mz0m4BM/8eIRoa8f6uoBAkEAnamIJjju5lsyQiZvAIM4D/OqBYnrKlfHoiT7WM2Y\n' +
            'aPZ3/BLGSwCpEuuPxibP3uvXMDJZHck6vPiCcz5XbercmQ==\n' +
            '-----END RSA PRIVATE KEY-----\n';
        let botmonitor = new BotMonitor(requestData, privatePemContent);
        botmonitor.setOprationTic("aa1");
        botmonitor.setOprationToc("aa1");
        botmonitor.setOprationToc("aa2");
        botmonitor.setOprationToc("aa2");
        botmonitor.setOprationToc("aa3");

        botmonitor.setEventStart();
        botmonitor.setEventEnd();

        botmonitor.setDeviceEventStart();
        botmonitor.setDeviceEventEnd();

        botmonitor.setAppName('baidu');
        botmonitor.setAudioUrl('baidu');
        botmonitor.setDeepLink('baidu');

        botmonitor.setResponseData(responseData);
        botmonitor.uploadData();
    });

    res.end('callback(\'{\"msg\": \"successed!\"}\')');
}).listen(8089, '127.0.0.1');

console.log('Server running');